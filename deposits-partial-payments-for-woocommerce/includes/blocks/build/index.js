(function(){'use strict';if(typeof wp==='undefined'||typeof wc==='undefined')return;var createReduxStore=wp.data.createReduxStore,register=wp.data.register,useSelect=wp.data.useSelect,createElement=wp.element.createElement,render=wp.element.render,useState=wp.element.useState,useCallback=wp.element.useCallback,getSetting=wc.wcSettings.getSetting;if(!wc.blocksCheckout||!wc.blocksComponents||!wc.wcBlocksData)return;var ExperimentalOrderMeta=wc.blocksCheckout.ExperimentalOrderMeta,extensionCartUpdate=wc.blocksCheckout.extensionCartUpdate,CART_STORE_KEY=wc.wcBlocksData.CART_STORE_KEY,TotalsWrapper=wc.blocksComponents.TotalsWrapper,TotalsItem=wc.blocksComponents.TotalsItem,FormattedMonetaryAmount=wc.blocksComponents.FormattedMonetaryAmount,getCurrencyFromPriceResponse=wc.priceFormat?wc.priceFormat.getCurrencyFromPriceResponse:null,blockData=getSetting('awcdp-blocks_data')||{},options=blockData.options||{},checkoutModeRaw=options.checkout_mode,isCheckoutMode=checkoutModeRaw===true||checkoutModeRaw===1||checkoutModeRaw==='1'||checkoutModeRaw==='yes',wcSettings=getSetting('currency')||getSetting('woocommerce_currency')||{},DEFAULT_STATE={sharedData:{depositMode:'deposit',selectedPaymentPlan:null,loading:false}},actions={setSharedData:function(sharedData){return{type:'SET_SHARED_DATA',sharedData:sharedData}}},reducer=function(state,action){if(state===undefined)state=DEFAULT_STATE;switch(action.type){case 'SET_SHARED_DATA':return Object.assign({},state,{sharedData:action.sharedData});default:return state}},selectors={getSharedData:function(state){return state.sharedData}};try{var store=createReduxStore('awcdp/blocks',{reducer:reducer,actions:actions,selectors:selectors});register(store)}catch(e){}function getValidCurrency(cartTotals){var defaultCurrency={code:'USD',symbol:'$',minorUnit:2,prefix:'$',suffix:'',decimalSeparator:'.',thousandSeparator:',',currency_code:'USD',currency_symbol:'$',currency_minor_unit:2,currency_prefix:'$',currency_suffix:'',currency_decimal_separator:'.',currency_thousand_separator:','};if(wcSettings&&wcSettings.code){defaultCurrency.code=wcSettings.code;defaultCurrency.currency_code=wcSettings.code;if(wcSettings.symbol){defaultCurrency.symbol=wcSettings.symbol;defaultCurrency.currency_symbol=wcSettings.symbol;defaultCurrency.prefix=wcSettings.symbol;defaultCurrency.currency_prefix=wcSettings.symbol}if(wcSettings.minorUnit!==undefined){defaultCurrency.minorUnit=wcSettings.minorUnit;defaultCurrency.currency_minor_unit=wcSettings.minorUnit}if(wcSettings.prefix!==undefined){defaultCurrency.prefix=wcSettings.prefix;defaultCurrency.currency_prefix=wcSettings.prefix}if(wcSettings.suffix!==undefined){defaultCurrency.suffix=wcSettings.suffix;defaultCurrency.currency_suffix=wcSettings.suffix}}if(cartTotals){if(cartTotals.currency_code){defaultCurrency.code=cartTotals.currency_code;defaultCurrency.currency_code=cartTotals.currency_code}if(cartTotals.currency_symbol){defaultCurrency.symbol=cartTotals.currency_symbol;defaultCurrency.currency_symbol=cartTotals.currency_symbol}if(cartTotals.currency_minor_unit!==undefined){defaultCurrency.minorUnit=cartTotals.currency_minor_unit;defaultCurrency.currency_minor_unit=cartTotals.currency_minor_unit}if(cartTotals.currency_prefix!==undefined){defaultCurrency.prefix=cartTotals.currency_prefix;defaultCurrency.currency_prefix=cartTotals.currency_prefix}if(cartTotals.currency_suffix!==undefined){defaultCurrency.suffix=cartTotals.currency_suffix;defaultCurrency.currency_suffix=cartTotals.currency_suffix}if(cartTotals.currency_decimal_separator){defaultCurrency.decimalSeparator=cartTotals.currency_decimal_separator;defaultCurrency.currency_decimal_separator=cartTotals.currency_decimal_separator}if(cartTotals.currency_thousand_separator!==undefined){defaultCurrency.thousandSeparator=cartTotals.currency_thousand_separator;defaultCurrency.currency_thousand_separator=cartTotals.currency_thousand_separator}}if(getCurrencyFromPriceResponse&&cartTotals){try{var extracted=getCurrencyFromPriceResponse(cartTotals);if(extracted){Object.keys(extracted).forEach(function(key){if(extracted[key]!==undefined&&extracted[key]!==null&&extracted[key]!==''){defaultCurrency[key]=extracted[key]}})}}catch(e){}}return defaultCurrency}function formatMoney(amount,currency){if(amount===undefined||amount===null||isNaN(amount))amount=0;var minorUnit=2,prefix='$',suffix='',decimalSep='.',thousandSep=',';if(currency){if(currency.minorUnit!==undefined)minorUnit=currency.minorUnit;else if(currency.currency_minor_unit!==undefined)minorUnit=currency.currency_minor_unit;if(currency.prefix!==undefined&&currency.prefix!=='')prefix=currency.prefix;else if(currency.currency_prefix!==undefined&&currency.currency_prefix!=='')prefix=currency.currency_prefix;else if(currency.symbol!==undefined)prefix=currency.symbol;else if(currency.currency_symbol!==undefined)prefix=currency.currency_symbol;if(currency.suffix!==undefined)suffix=currency.suffix;else if(currency.currency_suffix!==undefined)suffix=currency.currency_suffix;if(currency.decimalSeparator)decimalSep=currency.decimalSeparator;else if(currency.currency_decimal_separator)decimalSep=currency.currency_decimal_separator;if(currency.thousandSeparator!==undefined)thousandSep=currency.thousandSeparator;else if(currency.currency_thousand_separator!==undefined)thousandSep=currency.currency_thousand_separator}var formatted=parseFloat(amount).toFixed(minorUnit);var parts=formatted.split('.');parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,thousandSep);formatted=parts.join(decimalSep);if(suffix&&suffix!=='')return formatted+suffix;return prefix+formatted}function formatDate(timestamp){if(!timestamp)return'';var date=new Date(timestamp*1000);var opts={year:'numeric',month:'long',day:'numeric'};return date.toLocaleDateString(undefined,opts)}function calculateDepositAmount(cartTotal,amountType,depositSetting,paymentPlans,selectedPlan){if(!cartTotal||cartTotal<=0)return 0;var depositAmount=0;switch(amountType){case'fixed':depositAmount=parseFloat(depositSetting)||0;break;case'percent':case'percentage':var percentage=parseFloat(depositSetting)||0;depositAmount=(cartTotal*percentage)/100;break;case'payment_plan':if(paymentPlans&&paymentPlans.length>0){var plan=null;if(selectedPlan){for(var i=0;i<paymentPlans.length;i++){if(paymentPlans[i].id==selectedPlan){plan=paymentPlans[i];break}}}if(!plan)plan=paymentPlans[0];if(plan&&plan.deposit_percentage)depositAmount=(cartTotal*parseFloat(plan.deposit_percentage))/100}break}if(depositAmount>cartTotal)depositAmount=cartTotal;return depositAmount}function shouldShowDeposit(cartTotal,amountType,depositAmountSetting){if(amountType==='fixed'){var fixedAmount=parseFloat(depositAmountSetting)||0;if(fixedAmount>0&&cartTotal>0&&cartTotal<fixedAmount)return false}if(amountType==='percent'||amountType==='percentage'){var percentage=parseFloat(depositAmountSetting)||0;if(percentage<=0||percentage>=100)return false}return true}var DepositSliderComponent=function(){var cartState=useSelect(function(select){var cartStore=select(CART_STORE_KEY);if(!cartStore)return{cartTotals:null,extensions:{}};var data=cartStore.getCartData?cartStore.getCartData():{};return{cartTotals:cartStore.getCartTotals?cartStore.getCartTotals():null,extensions:data.extensions||{}}},[]);var extensionData=cartState.extensions.awcdp||{};var depositInfo=extensionData.deposit_info||{};var forceDeposit=options.force_deposit===true||options.force_deposit===1;var defaultChecked=options.default_checked||'deposit';var depositText=options.deposit_text||'Pay deposit';var fullText=options.full_text||'Pay full amount';var depositOptionText=options.deposit_option_text||'Pay a deposit of';var toPayText=options.to_pay_text||'Due Today';var futurePaymentText=options.future_payment_text||'Future Payments';var hideWhenForced=options.hide_when_forced===true;var amountType=options.amount_type||'percent';var depositAmountSetting=options.deposit_amount||0;var paymentPlans=options.payment_plans||[];var initialSelection=forceDeposit?'deposit':defaultChecked;if(extensionData.currently_selected)initialSelection=extensionData.currently_selected;var selectedState=useState(initialSelection);var selectedOption=selectedState[0];var setSelectedOption=selectedState[1];var initialPlan=extensionData.selected_plan||(paymentPlans.length>0?paymentPlans[0].id:null);var selectedPlanState=useState(initialPlan);var selectedPlan=selectedPlanState[0];var setSelectedPlan=selectedPlanState[1];var loadingState=useState(false);var isLoading=loadingState[0];var setIsLoading=loadingState[1];var handleOptionChange=useCallback(function(newOption,planId){setIsLoading(true);var updateData={deposit_option:newOption};if(planId)updateData.selected_plan=planId;if(typeof extensionCartUpdate==='function'){extensionCartUpdate({namespace:'awcdp',data:updateData}).then(function(){setIsLoading(false)}).catch(function(){setIsLoading(false)})}else{setIsLoading(false)}},[]);var onSelectDeposit=function(){if(selectedOption==='deposit')return;setSelectedOption('deposit');handleOptionChange('deposit',selectedPlan)};var onSelectFull=function(){if(forceDeposit||selectedOption==='full')return;setSelectedOption('full');handleOptionChange('full',null)};var onSelectPlan=function(planId){if(selectedPlan===planId&&selectedOption==='deposit')return;setSelectedPlan(planId);setSelectedOption('deposit');handleOptionChange('deposit',planId)};if(forceDeposit&&hideWhenForced)return null;var currency=getValidCurrency(cartState.cartTotals);var minorUnit=currency.minorUnit||currency.currency_minor_unit||2;var multiplier=Math.pow(10,minorUnit);var cartTotal=0;if(cartState.cartTotals&&cartState.cartTotals.total_price)cartTotal=parseInt(cartState.cartTotals.total_price,10)/multiplier;if(!shouldShowDeposit(cartTotal,amountType,depositAmountSetting))return null;var depositAmount=parseFloat(depositInfo.deposit_amount)||0;if(depositAmount<=0&&cartTotal>0)depositAmount=calculateDepositAmount(cartTotal,amountType,depositAmountSetting,paymentPlans,selectedPlan);var remainingAmount=parseFloat(depositInfo.remaining_amount)||0;if(remainingAmount<=0&&depositAmount>0&&cartTotal>0)remainingAmount=cartTotal-depositAmount;var children=[];var hasPaymentPlans=amountType==='payment_plan'&&paymentPlans.length>0;var depositOptionChildren=[createElement('input',{type:'radio',name:'awcdp_deposit_option',value:'deposit',checked:selectedOption==='deposit',onChange:function(){},readOnly:true}),createElement('span',{className:'radio-circle'})];var optionContentChildren=[createElement('span',{className:'option-label'},depositText)];if(!hasPaymentPlans){optionContentChildren.push(createElement('span',{className:'option-description'},depositOptionText+' ',createElement('span',{className:'amount'},FormattedMonetaryAmount&&depositAmount>0?createElement(FormattedMonetaryAmount,{value:Math.round(depositAmount*multiplier),currency:currency}):formatMoney(depositAmount,currency))))}depositOptionChildren.push(createElement('div',{className:'option-content'},optionContentChildren));children.push(createElement('div',{key:'deposit-option',className:'awcdp-option'+(selectedOption==='deposit'?' selected':''),onClick:onSelectDeposit},depositOptionChildren));if(hasPaymentPlans&&selectedOption==='deposit'){var planElements=paymentPlans.map(function(plan){var isSelected=selectedPlan===plan.id||selectedPlan===String(plan.id);var planDepositPercentage=parseFloat(plan.deposit_percentage)||0;var planDepositAmount=(cartTotal*planDepositPercentage)/100;var planDetails=plan.details||[];var scheduleRows=[];if(isSelected&&Array.isArray(planDetails)&&planDetails.length>0){scheduleRows.push(createElement('div',{key:'header',className:'awcdp-schedule-header'},createElement('span',{className:'awcdp-schedule-date'},'Payment Date'),createElement('span',{className:'awcdp-schedule-amount'},'Amount')));planDetails.forEach(function(detail,index){var paymentDate='';if(detail.date)paymentDate=formatDate(detail.date);else if(detail.after&&detail.after_term)paymentDate=detail.after+' '+detail.after_term+' after purchase';var paymentPercentage=parseFloat(detail.percentage)||0;var paymentAmount=(cartTotal*paymentPercentage)/100;scheduleRows.push(createElement('div',{key:'row-'+index,className:'awcdp-schedule-row'},createElement('span',{className:'awcdp-schedule-date'},paymentDate),createElement('span',{className:'awcdp-schedule-amount'},FormattedMonetaryAmount?createElement(FormattedMonetaryAmount,{value:Math.round(paymentAmount*multiplier),currency:currency}):formatMoney(paymentAmount,currency))))})}return createElement('div',{key:'plan-'+plan.id,className:'awcdp-payment-plan'+(isSelected?' selected':''),onClick:function(e){e.stopPropagation();onSelectPlan(plan.id)}},createElement('div',{className:'awcdp-plan-header'},createElement('span',{className:'awcdp-plan-check'},isSelected?createElement('svg',{width:'20',height:'20',viewBox:'0 0 24 24',fill:'none',stroke:'#22c55e',strokeWidth:'3',strokeLinecap:'round',strokeLinejoin:'round'},createElement('polyline',{points:'20 6 9 17 4 12'})):null),createElement('div',{className:'awcdp-plan-info'},createElement('span',{className:'awcdp-plan-name'},plan.name),createElement('span',{className:'awcdp-plan-deposit'},depositOptionText+' ',createElement('span',{className:'amount'},FormattedMonetaryAmount?createElement(FormattedMonetaryAmount,{value:Math.round(planDepositAmount*multiplier),currency:currency}):formatMoney(planDepositAmount,currency))))),scheduleRows.length>0&&createElement('div',{className:'awcdp-plan-schedule'},scheduleRows))});children.push(createElement('div',{key:'payment-plans',className:'awcdp-payment-plans'},planElements))}if(!forceDeposit){children.push(createElement('div',{key:'full-option',className:'awcdp-option'+(selectedOption==='full'?' selected':''),onClick:onSelectFull},createElement('input',{type:'radio',name:'awcdp_deposit_option',value:'full',checked:selectedOption==='full',onChange:function(){},readOnly:true}),createElement('span',{className:'radio-circle'}),createElement('div',{className:'option-content'},createElement('span',{className:'option-label'},fullText))))}if(selectedOption==='deposit'&&!hasPaymentPlans&&depositAmount>0){var summaryRows=[];summaryRows.push(createElement('div',{key:'due-today',className:'awcdp-summary-row due-today'},createElement('span',{className:'label'},toPayText),createElement('span',{className:'value'},FormattedMonetaryAmount?createElement(FormattedMonetaryAmount,{value:Math.round(depositAmount*multiplier),currency:currency}):formatMoney(depositAmount,currency))));summaryRows.push(createElement('div',{key:'future',className:'awcdp-summary-row future-payments'},createElement('span',{className:'label'},futurePaymentText),createElement('span',{className:'value'},FormattedMonetaryAmount?createElement(FormattedMonetaryAmount,{value:Math.round(remainingAmount*multiplier),currency:currency}):formatMoney(remainingAmount,currency))));children.push(createElement('div',{key:'summary',className:'awcdp-deposit-summary'},summaryRows))}if(isLoading){children.push(createElement('div',{key:'loading',className:'awcdp-loading-overlay'},createElement('span',{className:'awcdp-spinner'})))}return createElement('div',{className:'awcdp-blocks-deposit-slider'+(isLoading?' is-loading':'')},children)};var PartialPaymentsDisplay=function(){var cartData=useSelect(function(select){var cartStore=select(CART_STORE_KEY);if(!cartStore)return{};var data=cartStore.getCartData();return{cartTotals:cartStore.getCartTotals(),cartData:data,extensions:data&&data.extensions?data.extensions:{}}})||{};var extensionData=cartData.extensions&&cartData.extensions.awcdp?cartData.extensions.awcdp:{};var depositInfo=extensionData.deposit_info||{};var cartTotals=cartData.cartTotals||{};var currency=getValidCurrency(cartTotals);var toPayText=options.to_pay_text||'Due Today';var futurePaymentText=options.future_payment_text||'Future Payments';var depositEnabled=depositInfo.deposit_enabled||false;var depositAmount=depositInfo.deposit_amount||0;var futurePaymentsTotal=0;if(depositInfo.remaining_amount){futurePaymentsTotal=depositInfo.remaining_amount}else if(depositAmount>0&&cartTotals.total_price){var minorUnit=currency.minorUnit||currency.currency_minor_unit||2;var totalPrice=parseInt(cartTotals.total_price,10)/Math.pow(10,minorUnit);futurePaymentsTotal=totalPrice-depositAmount}var shouldShow=depositEnabled&&depositAmount>0;if(!shouldShow)return null;return createElement(TotalsWrapper,{className:'wc-block-awcdp-totals'},createElement(TotalsItem,{className:'awcdp-partial-payments-details awcdp-deposit-amount',currency:currency,label:toPayText,value:Math.round(depositAmount*100)}),createElement(TotalsItem,{className:'awcdp-partial-payments-details awcdp-future-amount',currency:currency,label:futurePaymentText,value:Math.round(futurePaymentsTotal*100)}))};var AWCDPCheckoutDisplay=function(){if(isCheckoutMode)return createElement(DepositSliderComponent);return createElement(PartialPaymentsDisplay)};window.awcdpBlocks={DepositSliderComponent:DepositSliderComponent,PartialPaymentsDisplay:PartialPaymentsDisplay,AWCDPCheckoutDisplay:AWCDPCheckoutDisplay,isCheckoutMode:isCheckoutMode};var SlotFillComponent=function(){return createElement(ExperimentalOrderMeta,null,createElement(AWCDPCheckoutDisplay))};if(wp.plugins&&wp.plugins.registerPlugin){try{wp.plugins.registerPlugin('awcdp-deposit-blocks',{render:SlotFillComponent,scope:'woocommerce-checkout'})}catch(e){}}function injectIntoCheckout(){var targetSelectors=['.wc-block-components-totals-wrapper','.wc-block-checkout__sidebar','.wp-block-woocommerce-checkout-order-summary-block','.wc-block-components-order-summary'];var container=null;for(var i=0;i<targetSelectors.length;i++){container=document.querySelector(targetSelectors[i]);if(container)break}if(!container)return false;if(document.getElementById('awcdp-blocks-container'))return true;var awcdpContainer=document.createElement('div');awcdpContainer.id='awcdp-blocks-container';awcdpContainer.className='awcdp-blocks-injected';container.insertBefore(awcdpContainer,container.firstChild);try{render(createElement(AWCDPCheckoutDisplay),awcdpContainer);return true}catch(e){return false}}function attemptInjection(attempts){if(attempts<=0)return;var slotFillRendered=document.querySelector('.awcdp-blocks-deposit-slider, .wc-block-awcdp-totals');if(slotFillRendered)return;if(!injectIntoCheckout()){setTimeout(function(){attemptInjection(attempts-1)},500)}}if(document.readyState==='complete'||document.readyState==='interactive'){setTimeout(function(){attemptInjection(10)},1000)}else{document.addEventListener('DOMContentLoaded',function(){setTimeout(function(){attemptInjection(10)},1000)})}})();
